<app-header></app-header>

<div class="container mx-auto py-8 bg-white font-sans mt-2 card animate-fade-in">
  <header class="mb-8 text-center bg-gradient-to-r from-blue-50 to-purple-50 mx-6 py-6 rounded-lg">
    <div class="flex items-center justify-center space-x-4">
      <div class="w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center">
        <i class="bi bi-cart2 text-white text-lg"></i>
      </div>
      <div>
        <h1 class="heading-1 text-gray-800 mb-0">My Shopping Bag</h1>
        <p class="text-gray-600 text-sm">Review your selected items</p>
      </div>
    </div>
  </header>

  <div class="flex flex-col lg:flex-row gap-8 items-start">

    <section class="lg:w-2/3">
      @for (item of cartItems; track item; let i = $index) {
        <div class="card mb-6 hover-lift animate-slide-in">
          <div class="card-body">
            <div class="flex flex-wrap items-center">

              <div class="w-1/4 text-center">
                <div class="relative overflow-hidden rounded-lg">
                  <img [src]="item.imageUrl" alt="{{ item.name }}" (error)="item.imageUrl = 'assets/default.jpg'"
                       class="w-16 h-16 object-cover transition-transform hover:scale-110 duration-300 shadow-md">
                </div>
              </div>
              
              <!-- details -->
              <div class="w-3/4 pl-6">
                <div class="border-b border-gray-100 pb-4">
                  <div class="flex justify-between items-start mb-3">
                    <div>
                      <h5 class="heading-3 text-gray-800 mb-1">{{ item.name }}</h5>
                      <p class="text-gray-500 text-sm">Premium Quality</p>
                    </div>
                    <div class="text-right">
                      <span class="text-2xl font-bold text-blue-600">₹{{ (item?.price ?? 0) * (item?.quantity ?? 0) }}</span>
                      <p class="text-gray-500 text-sm">₹{{ item?.price ?? 0 }} each</p>
                    </div>
                  </div>

                  <!-- for rating -->
                  <div class="flex items-center mb-4">
                    <div class="flex items-center bg-yellow-50 px-3 py-1 rounded-full">
                      @for (star of [1,2,3,4,5];track star) {
                        <i class="bi"
                          [ngClass]="{
                            'bi-star-fill': item.rating >= star,
                            'bi-star-half': item.rating >= (star - 0.5) && item.rating < star,
                            'bi-star': item.rating < (star - 0.5)
                          }"
                          class="text-yellow-500 text-sm"></i>
                      }
                      <span class="ml-2 text-sm font-medium text-gray-700">{{ item.rating.toFixed(1) }}</span>
                    </div>
                  </div>


                  <div class="flex flex-wrap gap-4 items-center">
                    <!-- Quantity Controls -->
                    <div class="flex items-center bg-gray-50 rounded-lg overflow-hidden border">
                      <button class="px-3 py-2 hover:bg-red-100 hover:text-red-600 transition-colors duration-200 disabled:opacity-50"
                              (click)="changeQuantity(i, -1)" [disabled]="item.quantity === 1">
                        <i class="bi bi-dash font-bold"></i>
                      </button>
                      <div class="px-4 py-2 bg-white border-x font-semibold text-center min-w-[3rem]">
                        {{ item.quantity }}
                      </div>
                      <button class="px-3 py-2 hover:bg-green-100 hover:text-green-600 transition-colors duration-200"
                              (click)="changeQuantity(i, 1)">
                        <i class="bi bi-plus font-bold"></i>
                      </button>
                    </div>
                    
                    @if ((item?.quantity ?? 0) > 5) {
                      <div class="bg-red-50 text-red-600 text-sm px-3 py-1 rounded-full">
                        <i class="bi bi-exclamation-triangle mr-1"></i>
                        Max limit is 5 per item
                      </div>
                    }
                    
                    <!-- Action Buttons -->
                    <div class="flex gap-3 ml-auto">
                      <button class="btn btn-secondary text-sm px-4 py-2 hover:bg-blue-50 hover:text-blue-600 hover:border-blue-200"
                              (click)="saveForLater(i)">
                        <i class="bi bi-bookmark-heart mr-2"></i>
                        Save for Later
                      </button>
                      <button class="btn btn-danger text-sm px-4 py-2"
                              (click)="confirmRemove(i)">
                        <i class="bi bi-trash3 mr-2"></i>
                        Remove
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      }


      @if (cartItems.length === 0) {
        <div class="card text-center mt-8 animate-fade-in">
          <div class="card-body py-12">
            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="bi bi-cart-x text-gray-400 text-3xl"></i>
            </div>
            <h3 class="heading-3 text-gray-600 mb-2">Your cart is empty</h3>
            <p class="text-gray-500 mb-6">Browse our amazing products and add them to your cart!</p>
            <a routerLink="/home" class="btn btn-primary">
              <i class="bi bi-arrow-left mr-2"></i>
              Start Shopping
            </a>
          </div>
        </div>
      }

      <div class="text-center mt-8">
        <a routerLink="/home" class="btn btn-secondary hover-lift">
          <i class="bi bi-arrow-left mr-2"></i>
          Continue Shopping
        </a>
      </div>
    </section>

    <aside class="lg:w-1/3">
      <div class="card sticky top-24 animate-slide-in">
        <div class="card-header text-center bg-gradient-to-r from-blue-50 to-purple-50">
          <div class="flex items-center justify-center space-x-2">
            <i class="bi bi-receipt text-blue-600"></i>
            <h5 class="heading-3 text-gray-800 mb-0">Order Summary</h5>
          </div>
        </div>

        <div class="card-body">
          <!-- Coupon Section -->
          <div class="form-group">
            <label for="coupon" class="form-label flex items-center">
              <i class="bi bi-tag mr-2 text-green-600"></i>
              Have a coupon?
            </label>
            <div class="flex">
              <input type="text" id="coupon" class="form-input rounded-r-none" [(ngModel)]="couponCode" placeholder="Enter coupon code">
              <button class="btn btn-success rounded-l-none px-6"
                      (click)="applyCoupon()">
                Apply
              </button>
            </div>
          </div>

          <!-- Order Breakdown -->
          <div class="bg-gray-50 rounded-lg p-4 space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-gray-600">Total Items</span>
              <span class="font-semibold text-gray-800">{{ cartItems.length }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-600">Subtotal</span>
              <span class="font-semibold text-gray-800">₹{{ totalAmount.toFixed(2) }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-600">Shipping</span>
              <span class="font-semibold text-green-600 flex items-center">
                <i class="bi bi-truck mr-1"></i>
                FREE
              </span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-600">Tax (GST)</span>
              <span class="font-semibold text-gray-800">₹0</span>
            </div>
            <hr class="border-gray-200">
            <div class="flex justify-between items-center text-lg">
              <span class="font-bold text-gray-800">ORDER TOTAL</span>
              <span class="font-bold text-blue-600 text-xl">₹{{ totalAmount.toFixed(2) }}</span>
            </div>
          </div>

          <p class="text-center text-gray-500 text-sm mb-6">Includes all taxes and applied discounts</p>

          <div class="space-y-3">
            <button class="btn btn-success w-full py-4 text-lg hover-lift"
                    (click)="proceedToCheckout()">
              <i class="bi bi-bag-check-fill mr-2"></i>
              Proceed to Checkout
            </button>
            <div class="text-center">
              <div class="flex items-center justify-center space-x-2 text-gray-500 text-sm">
                <i class="bi bi-shield-check text-green-600"></i>
                <span>Secure payment via card, UPI & net banking</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>
</div>
<app-footer></app-footer>
